<!DOCTYPE html>
<html>
<head>
    <title>Map of Existing Panoramas</title>
    <style>
        #map {
            height: 400px;
            width: 100%;
        }
    </style>
</head>
<body>
<h3>Existing Panoramas</h3>
All existing panoramas are displayed on the map below.<br>
Click on a point to see panorama data and to edit the panorama.
<div id="map"></div>
<li><a href="index.html">Return to index</a></li>
<script>

    var jsonPanos;

    function initMap() {

        var xobj = new XMLHttpRequest();
        xobj.overrideMimeType("application/json");
        xobj.open('GET', '/getAllPanos', false);
        xobj.send();
        jsonPanos = JSON.parse(xobj.responseText);

        var mapCenter = {lat: 0, lng: 0};

        var markers = jsonPanos.map(function (panorama, i) {
            mapCenter.lat += panorama.lat / jsonPanos.length;
            mapCenter.lng += panorama.lng / jsonPanos.length;

            var marker = new google.maps.Marker({
                position: panorama,
                title: 'id: ' + panorama.panoramaId
            });


            return marker;
        });

        var map = new google.maps.Map(document.getElementById('map'), {
            zoom: 5,
            center: mapCenter
        });

        var markerCluster = new MarkerClusterer(map, markers,
            {imagePath: 'GoogleResources/m'});
    }
</script>
<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBUTckKb884QoQ1qaan9dxI-I1jx70Amb8&callback=initMap">
</script>
<script src="GoogleResources/markerclusterer.js">
</script>
</body>
</html>